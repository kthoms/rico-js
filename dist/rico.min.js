/*! For license information please see rico.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ricojs=t():e.ricojs=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){"use strict";n.r(t),n.d(t,"LoggerFactory",(function(){return C})),n.d(t,"LogLevel",(function(){return o})),n.d(t,"getService",(function(){return Ut})),n.d(t,"hasService",(function(){return xt})),n.d(t,"registerServiceProvider",(function(){return jt})),n.d(t,"HTTP",(function(){return A}));var r,o={NONE:{name:"NONE",text:"[NONE ]",level:0},ALL:{name:"ALL",text:"[ALL  ]",level:100},TRACE:{name:"TRACE",text:"[TRACE]",level:5},DEBUG:{name:"DEBUG",text:"[DEBUG]",level:4},INFO:{name:"INFO",text:"[INFO ]",level:3},WARN:{name:"WARN",text:"[WARN ]",level:2},ERROR:{name:"ERROR",text:"[ERROR]",level:1}};function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e){return null!=e}function u(e){r=e}function s(e,t){if(!l(e))throw new Error("The parameter "+t+" is mandatory in "+r)}function c(e){var t,n=e.match(/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/);n[4]&&n[4].length>1&&(t=n[4].substring(0,n[4].length-1));var r,o,i=n[13];if(n[16]&&n[16].length>1){var l=(r=n[16].substring(1,n[16].length)).split("&");r=l.reduce((function(e,t){var n=a(t.split("="),2),r=n[0],o=n[1];return Object.assign(e,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,o))}),{})}n[17]&&n[17].length>1&&(o=n[17].substring(1,n[17].length));var u=n[11],s=n[12];return u&&!s&&"http"===t?s=80:u&&!s&&"https"===t&&(s=443),u||s||t||(window&&window.location&&window.location.hostname&&(u=window.location.hostname),window&&window.location&&window.location.port&&(s=window.location.port),window&&window.location&&window.location.protocol&&(t=window.location.protocol.substring(0,window.location.protocol.length-1)),0===i.indexOf(".")&&(i=i.substring(1,i.length))),s&&(s=parseInt(s)),{scheme:t,user:n[8],password:n[9],hostname:u,port:s,path:i,query:r,fragment:o}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p={pad:function(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n},internalLog:function(){var e=Array.from(arguments),t=e.shift(),n=e.shift(),r=e.shift(),o=new Date,a=o.getFullYear()+"-"+p.pad(o.getMonth()+1,2)+"-"+p.pad(o.getDate(),2)+" "+p.pad(o.getHours(),2)+":"+p.pad(o.getMinutes(),2)+":"+p.pad(o.getSeconds(),2)+"."+p.pad(o.getMilliseconds(),3);t.apply(void 0,[a,r.text,n].concat(f(e)))},getCookie:function(e){if(l(window)&&l(window.document)&&l(window.document.cookie)){var t=("; "+window.document.cookie).split("; "+e+"=");if(2===t.length)return t.pop().split(";").shift()}}},v=function(){function e(t,n){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.context=t,this.rootLogger=n,p.getCookie("RICO_LOGGER_"+this.context)){case"NONE":this.logLevel=o.NONE;break;case"ALL":this.logLevel=o.ALL;break;case"TRACE":this.logLevel=o.TRACE;break;case"DEBUG":this.logLevel=o.DEBUG;break;case"INFO":this.logLevel=o.INFO;break;case"WARN":this.logLevel=o.WARN;break;case"ERROR":this.logLevel=o.ERROR}}var t,n,r;return t=e,(n=[{key:"trace",value:function(){l(console)&&this.isLogLevel(o.TRACE)&&p.internalLog.apply(p,[console.log,this.context,o.TRACE].concat(Array.prototype.slice.call(arguments)))}},{key:"debug",value:function(){l(console)&&this.isLogLevel(o.DEBUG)&&p.internalLog.apply(p,[console.log,this.context,o.DEBUG].concat(Array.prototype.slice.call(arguments)))}},{key:"info",value:function(){l(console)&&this.isLogLevel(o.INFO)&&p.internalLog.apply(p,[console.log,this.context,o.INFO].concat(Array.prototype.slice.call(arguments)))}},{key:"warn",value:function(){l(console)&&this.isLogLevel(o.WARN)&&p.internalLog.apply(p,[console.warn,this.context,o.WARN].concat(Array.prototype.slice.call(arguments)))}},{key:"error",value:function(){l(console)&&this.isLogLevel(o.ERROR)&&p.internalLog.apply(p,[console.error,this.context,o.ERROR].concat(Array.prototype.slice.call(arguments)))}},{key:"getLogLevel",value:function(){return l(this.logLevel)?this.logLevel:l(this.rootLogger)?this.rootLogger.getLogLevel():o.INFO}},{key:"setLogLevel",value:function(e){this.logLevel=e}},{key:"setLogLevelByName",value:function(e){l(o[e])&&(this.logLevel=o[e])}},{key:"isLogLevel",value:function(e){return this.getLogLevel()!==o.NONE&&(this.getLogLevel()===o.ALL||this.getLogLevel()===o.TRACE||this.getLogLevel()===o.DEBUG&&e!==o.TRACE||this.getLogLevel()===o.INFO&&e!==o.TRACE&&e!==o.DEBUG||this.getLogLevel()===o.WARN&&e!==o.TRACE&&e!==o.DEBUG&&e!==o.INFO||this.getLogLevel()===o.ERROR&&e!==o.TRACE&&e!==o.DEBUG&&e!==o.INFO&&e!==o.WARN)}},{key:"isLogLevelUseable",value:function(e){return s(e,"level"),!!e.level&&this.getLogLevel().level>=e.level}}])&&d(t.prototype,n),r&&d(t,r),e}();function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=new v("ROOT"),g={loggers:new Map},C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getLogger",value:function(e){if(!l(e)||"ROOT"===e)return m;var t=g.loggers.get(e);if(t)return t;var n=new v(e,m);return g.loggers.set(e,n),n}}],(n=null)&&y(t.prototype,n),r&&y(t,r),e}();var b=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}b.LOGGER=C.getLogger("Client"),b.services=new Map,b.serviceProviders=new Map,b.configuration={},b.getService=function(e){var t=b.services.get(e);if(!l(t)){var n=b.serviceProviders.get(e);if(!l(n))throw new Error("No service provider found for "+e);t=n.getService(b.configuration),b.services.set(e,t)}return t},b.hasService=function(e){return!!l(b.serviceProviders.get(e))},b.getAllServiceTypes=function(){var e=[];return b.serviceProviders.forEach((function(t){return e.push(t)})),e},b.registerServiceProvider=function(e){if(null==e)throw new Error("Cannot register empty service provider");if("function"!=typeof e.getName||"function"!=typeof e.getService)throw new Error("Cannot register service provider without getName() and getService() methods");if(b.serviceProviders.get(e.getName()))throw new Error("Cannot register another service provider. Name already in use.");b.serviceProviders.set(e.getName(),e),b.LOGGER.debug("Service provider registered with name",e.getName())},b.init=function(){b.serviceProviders.forEach((function(e){var t=e.getService();b.LOGGER.trace("Initializing service for service provider",e.getName()),"function"==typeof t.initServiceProvider&&(b.LOGGER.debug("Initializing service",t),t.initServiceProvider(b))}))};var w=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("constructor"),s(t,"serviceClass"),s(n,"name"),this.serviceInstance=new t(r),this.name=n}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"getService",value:function(){return this.serviceInstance}}])&&E(t.prototype,n),r&&E(t,r),e}(),R="arraybuffer",T="text",k="json",A={METHOD:{GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},STATUS:{ACCEPTED:202,BAD_GATEWAY:502,BAD_REQUEST:400,CONFLICT:409,CONTINUE:100,CREATED:201,EXPECTATION_FAILED:417,FAILED_DEPENDENCY:424,FORBIDDEN:403,GATEWAY_TIMEOUT:504,GONE:410,HTTP_VERSION_NOT_SUPPORTED:505,IM_A_TEAPOT:418,INSUFFICIENT_SPACE_ON_RESOURCE:419,INSUFFICIENT_STORAGE:507,INTERNAL_SERVER_ERROR:500,LENGTH_REQUIRED:411,LOCKED:423,METHOD_FAILURE:420,METHOD_NOT_ALLOWED:405,MOVED_PERMANENTLY:301,MOVED_TEMPORARILY:302,MULTI_STATUS:207,MULTIPLE_CHOICES:300,NETWORK_AUTHENTICATION_REQUIRED:511,NO_CONTENT:204,NON_AUTHORITATIVE_INFORMATION:203,NOT_ACCEPTABLE:406,NOT_FOUND:404,NOT_IMPLEMENTED:501,NOT_MODIFIED:304,OK:200,PARTIAL_CONTENT:206,PAYMENT_REQUIRED:402,PERMANENT_REDIRECT:308,PRECONDITION_FAILED:412,PRECONDITION_REQUIRED:428,PROCESSING:102,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_HEADER_FIELDS_TOO_LARGE:431,REQUEST_TIMEOUT:408,REQUEST_TOO_LONG:413,REQUEST_URI_TOO_LONG:414,REQUESTED_RANGE_NOT_SATISFIABLE:416,RESET_CONTENT:205,SEE_OTHER:303,SERVICE_UNAVAILABLE:503,SWITCHING_PROTOCOLS:101,TEMPORARY_REDIRECT:307,TOO_MANY_REQUESTS:429,UNAUTHORIZED:401,UNPROCESSABLE_ENTITY:422,UNSUPPORTED_MEDIA_TYPE:415,USE_PROXY:305},HEADER_NAME:{ACCEPT:"Accept",ACCEPT_CHARSET:"Accept-Charset",ACCEPT_ENCODING:"Accept-Encoding",ACCEPT_LANGUAGE:"Accept-Language",ACCEPT_DATETIME:"Accept-Datetime",AUTHORIZATION:"Authorization",CACHE_CONTROL:"Cache-Control",CONNECTION:"Connection",COOKIE:"Cookie",CONTENT_LENGTH:"Content-Length",CONTENT_MD5:"Content-MD5",CONTENT_TYPE:"Content-Type",DATE:"Date",EXPECT:"Expect",FORWARDED:"Forwarded",FROM:"From",HOST:"Host",IF_MATCH:"If-Match",IF_MODIFIED_SINCE:"If-Modified_Since",IF_NONE_MATCH:"If-None_Match",IF_RANGE:"If-Range",MAX_FORWARDS:"Max-Forwards",PRAGMA:"Pragma",PROXY_AUTHORIZATION:"Proxy-Authorization",REFERER:"Referer",TE:"TE",USER_AGENT:"User-Agent",X_CLIENT_ID:"X-Client-Id",X_CLIENT_SESSION_ID:"X-Client-Session-Id",X_PLATFORM_SECURITY_REALM:"X-platform-security-realm",X_PLATFORM_SECURITY_BEARER_ONLY:"X-platform-security-bearer-only",X_PLATFORM_SECURITY_APPLICATION:"X-platform-security-application"},CONTENT_TYPE:{APPLICATION_JSON:"application/json",APPLICATION_X_WWW_FORM_URLENCODED:"application/x-www-form-urlencoded",TEXT_HTML:"text/html",TEXT_PLAIN:"text/plain"},XMLHTTPREQUEST_READYSTATE:{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}},P="/openid-connect";function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(t,n,r,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.status=n,this.content=r,this.headers={},l(o)&&"string"==typeof o)for(var a=o.trim().split(/[\r\n]+/),i=0;i<a.length;i++){var u=a[i].split(": ");if(2===u.length){var s=u.shift().toLowerCase(),c=u.join(": ");this.headers[s]=c}}}var t,n,r;return t=e,(n=[{key:"getUrl",value:function(){return this.url}},{key:"getContent",value:function(){return this.content}},{key:"getStatus",value:function(){return this.status}},{key:"getHeaders",value:function(){return this.headers}},{key:"getHeaderByName",value:function(e){return u("getHeaderByName"),s(e,"name"),this.headers[e.toLowerCase()]}}])&&_(t.prototype,n),r&&_(t,r),e}();function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.message=t,this.status=n||0,this.timedout=r||!1}var t,n,r;return t=e,(n=[{key:"getMessage",value:function(){return this.message}},{key:"getStatus",value:function(){return this.status}},{key:"isTimedout",value:function(){return this.timedout}}])&&O(t.prototype,n),r&&O(t,r),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var N=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configuration=t,this.client=n}var t,n,r;return t=e,(n=[{key:"execute",value:function(t,n){var r=this,o=null;this.client&&this.client.hasService("HttpWorker")&&(o=this.client.getService("HttpWorker"));var a=null!==o&&(!0===n||!0===t),i=0;!0!==t&&!1!==t&&(i=t);var l=[];this.client&&(l=this.client.getService("HttpClientInterceptor").getRequestInterceptors(),e.LOGGER.trace("Request interceptors found:",l));var u=[];this.client&&(u=this.client.getService("HttpClientInterceptor").getResponseInterceptors(),e.LOGGER.trace("Response interceptors found:",u));var s=function(t,n){var o=r,a=new XMLHttpRequest;a.open(r.configuration.method,r.configuration.url,!0),a.url=r.configuration.url,a.method=r.configuration.method,a.withCredentials=!0;for(var s=0;s<l.length;s++)l[s].handleRequest(a);if(r.configuration.headers&&r.configuration.headers.length>0)for(var c=0;c<r.configuration.headers.length;c++){var d=r.configuration.headers[c];a.setRequestHeader(d.name,d.value)}a.timeout=i,r.configuration.responseType&&(a.responseType=r.configuration.responseType),a.ontimeout=function(){var t=this.statusText||"Timeout occurred",r=new I(t,this.status,!0);e.LOGGER.error(r),n(r)},a.onerror=function(){var t=this.statusText||"Unspecified error occured",r=new I(t,this.status);e.LOGGER.error(r),n(r)},a.onreadystatechange=function(){if(this.readyState===A.XMLHTTPREQUEST_READYSTATE.DONE&&e.LOGGER.trace("Request to ",o.configuration.url,"finished with",this.status),this.readyState===A.XMLHTTPREQUEST_READYSTATE.DONE&&this.status>=200&&this.status<300){for(var r=new M(this.url,this.status,this.response,this.getAllResponseHeaders()),a=0;a<u.length;a++)u[a].handleResponse(r);t(r)}else if(this.readyState===A.XMLHTTPREQUEST_READYSTATE.DONE&&this.status>=300){var i=new I(this.statusText,this.status);e.LOGGER.error(i),n(i)}},a.send(r.configuration.requestBody)};s=s.bind(this);var c=function(t,n){for(var a=[],s=0;s<l.length;s++)l[s].handleRequest({url:r.configuration.url,setRequestHeader:function(e,t){var n={name:e,value:t};a.push(n)}});var c=o.createWorker();try{c.onmessage=function(r){c.terminate(),e.LOGGER.trace("Message form Worker",r);var o=r.data;if(o.error){var a=new I(o.message,o.status,o.timedout);e.LOGGER.error(a),n(a)}else{for(var i=new M(o.url,o.status,o.response,o.responseHeaders),l=0;l<u.length;l++)u[l].handleResponse(i);t(i)}},c.onerror=function(e){var t=new I(e.data,0,!1);n(t)},c.postMessage({conf:r.configuration,timeout:i,requestHeaders:a})}catch(e){var d=new I(e,0,!1);n(d)}};return c=c.bind(this),new Promise((function(e,t){a&&r.client&&r.client.hasService("HttpWorker")?c(e,t):s(e,t)}))}}])&&S(t.prototype,n),r&&S(t,r),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}N.LOGGER=C.getLogger("Executor");var D=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configuration=t,this.executor=new N(t,n)}var t,n,r;return t=e,(n=[{key:"readBytes",value:function(){return this.configuration.responseType=R,this.executor}},{key:"readString",value:function(){return this.configuration.responseType=T,this.executor}},{key:"readObject",value:function(){return this.configuration.responseType=k,this.executor}},{key:"withoutResult",value:function(){return this.executor}}])&&L(t.prototype,n),r&&L(t,r),e}();function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configuration=t,this.reponseBuilder=new D(t,n)}var t,n,r;return t=e,(n=[{key:"withHeader",value:function(e,t){return this.configuration.headers||(this.configuration.headers=[]),this.configuration.headers.push({name:e,value:t}),this}},{key:"withHeadersInfo",value:function(e){if(l(e))for(var t in this.configuration.headers||(this.configuration.headers=[]),e)if(e.hasOwnProperty(t)){var n=e[t];this.configuration.headers.push({name:t,value:n})}return this}},{key:"withContent",value:function(e){return this.configuration.requestBody=e,this.reponseBuilder}},{key:"withoutContent",value:function(){return this.reponseBuilder}}])&&H(t.prototype,n),r&&H(t,r),e}();function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t}var t,n,r;return t=e,(n=[{key:"request",value:function(e,t){var n={url:e,method:t};return this.requestBuilder=new B(n,this.client),this.requestBuilder}},{key:"get",value:function(e){return this.request(e,A.METHOD.GET)}},{key:"post",value:function(e){return this.request(e,A.METHOD.POST)}},{key:"put",value:function(e){return this.request(e,A.METHOD.PUT)}},{key:"delete",value:function(e){return this.request(e,A.METHOD.DELETE)}}])&&G(t.prototype,n),r&&G(t,r),e}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.requestHandlers=new Set,this.responseHandlers=new Set}var t,n,r;return t=e,(n=[{key:"addRequestInterceptor",value:function(e){this.requestHandlers.add(e)}},{key:"getRequestInterceptors",value:function(){var e=[];return this.requestHandlers.forEach((function(t){return e.push(t)})),e}},{key:"addResponseInterceptor",value:function(e){this.responseHandlers.add(e)}},{key:"getResponseInterceptors",value:function(){var e=[];return this.responseHandlers.forEach((function(t){return e.push(t)})),e}}])&&x(t.prototype,n),r&&x(t,r),e}();function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clientIds=new Map}var t,n,r;return t=e,(n=[{key:"handleRequest",value:function(t){u("handleRequest"),s(t,"httpRequest");var n=this.getClientId(t.url);l(n)&&(e.LOGGER.trace("Using ClientId",n),t.setRequestHeader(A.HEADER_NAME.X_CLIENT_SESSION_ID,n))}},{key:"handleResponse",value:function(t){u("handleResponse"),s(t,"httpResponse");var n=this.getClientId(t.url),r=t.getHeaderByName(A.HEADER_NAME.X_CLIENT_SESSION_ID);if(l(n)&&l(r)&&n!==r)throw new Error("Client Id does not match!");!l(n)&&l(r)&&(e.LOGGER.debug("New ClientId found",r),this.setClientId(t.url,r))}},{key:"initServiceProvider",value:function(e){u("initServiceProvider"),s(e,"client"),e.getService("HttpClientInterceptor").addRequestInterceptor(this),e.getService("HttpClientInterceptor").addResponseInterceptor(this)}},{key:"getClientId",value:function(t){var n=c(t),r=e.calcKey(n.hostname,n.port);return this.clientIds.get(r)}},{key:"setClientId",value:function(t,n){var r=c(t),o=e.calcKey(r.hostname,r.port);this.clientIds.set(o,n),e.LOGGER.trace("Setting ClientId",n,"for",t,"with key",o)}}])&&V(t.prototype,n),r&&V(t,r),e}();q.calcKey=function(e,t){return e+t},q.LOGGER=C.getLogger("ClientScope");function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Y=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;F(this,e),this.folding=t,this.maxBatchSize=n}var t,n,r;return t=e,(n=[{key:"batch",value:function(e){for(var t=[],n=0;e[n]&&n<=this.maxBatchSize;){var r=e[n];if(n++,this.folding?"ValueChanged"==r.command.id&&t.length>0&&"ValueChanged"==t[t.length-1].command.id&&r.command.attributeId==t[t.length-1].command.attributeId?t[t.length-1].command.newValue=r.command.newValue:"PresentationModelDeleted"==r.command.id||t.push(r):t.push(r),r.handler)break}return e.splice(0,n),t}}])&&Q(t.prototype,n),r&&Q(t,r),e}();function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="ValueChanged"}var t,n,r;return t=e,(n=[{key:"init",value:function(e,t){u("ValueChangedCommand.init()"),s(e,"attributeId"),this.attributeId=e,this.newValue=t}}])&&X(t.prototype,n),r&&X(t,r),e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="AttributeMetadataChanged"}var t,n,r;return t=e,(n=[{key:"init",value:function(e,t,n){u("AttributeMetadataChangedCommand.init()"),s(e,"attributeId"),s(t,"metadataName"),this.attributeId=e,this.metadataName=t,this.value=n}}])&&K(t.prototype,n),r&&K(t,r),e}();function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="CallAction"}var t,n,r;return t=e,(n=[{key:"init",value:function(e,t,n){u("CreateControllerCommand.init()"),s(e,"controllerid"),s(t,"actionName"),this.controllerid=e,this.actionName=t,this.params=n}}])&&Z(t.prototype,n),r&&Z(t,r),e}();function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="ChangeAttributeMetadata"}var t,n,r;return t=e,(n=[{key:"init",value:function(e,t,n){u("ChangeAttributeMetadataCommand.init()"),s(e,"attributeId"),s(t,"metadataName"),this.attributeId=e,this.metadataName=t,this.value=n}}])&&$(t.prototype,n),r&&$(t,r),e}();var te=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="CreateContext"};function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="CreateController"}var t,n,r;return t=e,(n=[{key:"init",value:function(e,t){u("CreateControllerCommand.init()"),s(e,"controllerName"),this.controllerName=e,this.parentControllerId=t}}])&&ne(t.prototype,n),r&&ne(t,r),e}();function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="CreatePresentationModel"}var t,n,r;return t=e,(n=[{key:"init",value:function(e){u("CreatePresentationModelCommand.init()"),s(e,"presentationModel"),this.attributes=[],this.clientSideOnly=!1,this.pmId=e.id,this.pmType=e.presentationModelType;var t=this;e.getAttributes().forEach((function(e){t.attributes.push({propertyName:e.propertyName,id:e.id,value:e.getValue()})}))}}])&&oe(t.prototype,n),r&&oe(t,r),e}();function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var le=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="DeletePresentationModel"}var t,n,r;return t=e,(n=[{key:"init",value:function(e){u("DeletePresentationModelCommand.init()"),s(e,"pmId"),this.pmId=e}}])&&ie(t.prototype,n),r&&ie(t,r),e}();var ue=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="DestroyContext"};function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="DestroyController"}var t,n,r;return t=e,(n=[{key:"init",value:function(e){u("DestroyControllerCommand.init()"),s(e,"controllerId"),this.controllerId=e}}])&&se(t.prototype,n),r&&se(t,r),e}();var de=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="InterruptLongPoll"};function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var he=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="PresentationModelDeleted"}var t,n,r;return t=e,(n=[{key:"init",value:function(e){u("PresentationModelDeletedCommand.init()"),s(e,"pmId"),this.pmId=e}}])&&fe(t.prototype,n),r&&fe(t,r),e}();var pe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="StartLongPoll"};function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){return!t||"object"!==ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function me(e){var t="function"==typeof Map?new Map:void 0;return(me=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return ge(e,arguments,Ee(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),be(r,e)})(e)}function ge(e,t,n){return(ge=Ce()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&be(o,n.prototype),o}).apply(null,arguments)}function Ce(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(r,e);var t,n=(t=r,function(){var e,n=Ee(t);if(Ce()){var r=Ee(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return ye(this,e)});function r(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n.call(this,e)}return r}(me(Error));function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ke=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"_encodeAttributeMetadataChangedCommand",value:function(e){u("Codec.encodeAttributeMetadataChangedCommand"),s(e,"command"),s(e.attributeId,"command.attributeId"),s(e.metadataName,"command.metadataName");var t={id:"AttributeMetadataChanged"};return t.a_id=e.attributeId,t.n=e.metadataName,t.v=e.value,t}},{key:"_decodeAttributeMetadataChangedCommand",value:function(e){u("Codec.decodeAttributeMetadataChangedCommand"),s(e,"jsonCommand"),s(e.a_id,"jsonCommand[ATTRIBUTE_ID]"),s(e.n,"jsonCommand[NAME]");var t=new z;return t.attributeId=e.a_id,t.metadataName=e.n,t.value=e.v,t}},{key:"_encodeCallActionCommand",value:function(e){u("Codec.encodeCallActionCommand"),s(e,"command"),s(e.controllerid,"command.controllerid"),s(e.actionName,"command.actionName"),s(e.params,"command.params");var t={id:"CallAction"};return t.c_id=e.controllerid,t.n=e.actionName,t.p=e.params.map((function(e){var t={};return t.n=e.name,l(e.value)&&(t.v=e.value),t})),t}},{key:"_decodeCallActionCommand",value:function(e){u("Codec.decodeCallActionCommand"),s(e,"jsonCommand"),s(e.c_id,"jsonCommand[CONTROLLER_ID]"),s(e.n,"jsonCommand[NAME]"),s(e.p,"jsonCommand[PARAMS]");var t=new J;return t.controllerid=e.c_id,t.actionName=e.n,t.params=e.p.map((function(e){return{name:e.n,value:l(e.v)?e.v:null}})),t}},{key:"_encodeChangeAttributeMetadataCommand",value:function(e){u("Codec.encodeChangeAttributeMetadataCommand"),s(e,"command"),s(e.attributeId,"command.attributeId"),s(e.metadataName,"command.metadataName");var t={id:"ChangeAttributeMetadata"};return t.a_id=e.attributeId,t.n=e.metadataName,t.v=e.value,t}},{key:"_decodeChangeAttributeMetadataCommand",value:function(e){u("Codec.decodeChangeAttributeMetadataCommand"),s(e,"jsonCommand"),s(e.a_id,"jsonCommand[ATTRIBUTE_ID]"),s(e.n,"jsonCommand[NAME]");var t=new ee;return t.attributeId=e.a_id,t.metadataName=e.n,t.value=e.v,t}},{key:"_encodeCreateContextCommand",value:function(e){u("Codec.encodeCreateContextCommand"),s(e,"command");var t={id:"CreateContext"};return t}},{key:"_decodeCreateContextCommand",value:function(e){return u("Codec.decodeCreateContextCommand"),s(e,"jsonCommand"),new te}},{key:"_encodeCreateControllerCommand",value:function(e){u("Codec._encodeCreateControllerCommand"),s(e,"command"),s(e.controllerName,"command.controllerName");var t={id:"CreateController"};return t.n=e.controllerName,t.c_id=e.parentControllerId,t}},{key:"_decodeCreateControllerCommand",value:function(e){u("Codec._decodeCreateControllerCommand"),s(e,"jsonCommand"),s(e.n,"jsonCommand[NAME]"),s(e.c_id,"jsonCommand[CONTROLLER_ID]");var t=new re;return t.controllerName=e.n,t.parentControllerId=e.c_id,t}},{key:"_encodeCreatePresentationModelCommand",value:function(e){u("Codec.encodeCreatePresentationModelCommand"),s(e,"command"),s(e.pmId,"command.pmId"),s(e.pmType,"command.pmType");var t={id:"CreatePresentationModel"};return t.p_id=e.pmId,t.t=e.pmType,t.a=e.attributes.map((function(e){var t={};return t.n=e.propertyName,t.a_id=e.id,l(e.value)&&(t.v=e.value),t})),t}},{key:"_decodeCreatePresentationModelCommand",value:function(e){u("Codec.decodeCreatePresentationModelCommand"),s(e,"jsonCommand"),s(e.p_id,"jsonCommand[PM_ID]"),s(e.t,"jsonCommand[PM_TYPE]");var t=new ae;return t.pmId=e.p_id,t.pmType=e.t,t.attributes=e.a.map((function(e){return{propertyName:e.n,id:e.a_id,value:l(e.v)?e.v:null}})),t}},{key:"_encodeDeletePresentationModelCommand",value:function(e){u("Codec._encodeDeletePresentationModelCommand"),s(e,"command"),s(e.pmId,"command.pmId");var t={id:"DeletePresentationModel"};return t.p_id=e.pmId,t}},{key:"_decodeDeletePresentationModelCommand",value:function(e){u("Codec._decodeDeletePresentationModelCommand"),s(e,"jsonCommand"),s(e.p_id,"jsonCommand[PM_ID]");var t=new le;return t.pmId=e.p_id,t}},{key:"_encodeDestroyContextCommand",value:function(e){u("Codec._encodeDestroyContextCommand"),s(e,"command");var t={id:"DestroyContext"};return t}},{key:"_decodeDestroyContextCommand",value:function(e){return u("Codec._decodeDestroyContextCommand"),s(e,"jsonCommand"),new ue}},{key:"_encodeDestroyControllerCommand",value:function(e){u("Codec._encodeDestroyControllerCommand"),s(e,"command"),s(e.controllerId,"command.controllerId");var t={id:"DestroyController"};return t.c_id=e.controllerId,t}},{key:"_decodeDestroyControllerCommand",value:function(e){u("Codec._decodeDestroyControllerCommand"),s(e,"jsonCommand"),s(e.c_id,"jsonCommand[CONTROLLER_ID]");var t=new ce;return t.controllerId=e.c_id,t}},{key:"_encodeInterruptLongPollCommand",value:function(e){u("Codec._encodeInterruptLongPollCommand"),s(e,"command");var t={id:"InterruptLongPoll"};return t}},{key:"_decodeInterruptLongPollCommand",value:function(e){return u("Codec._decodeInterruptLongPollCommand"),s(e,"jsonCommand"),new de}},{key:"_encodePresentationModelDeletedCommand",value:function(e){u("Codec._encodePresentationModelDeletedCommand"),s(e,"command"),s(e.pmId,"command.pmId");var t={id:"PresentationModelDeleted"};return t.p_id=e.pmId,t}},{key:"_decodePresentationModelDeletedCommand",value:function(e){u("Codec._decodePresentationModelDeletedCommand"),s(e,"jsonCommand"),s(e.p_id,"jsonCommand[PM_ID]");var t=new he;return t.pmId=e.p_id,t}},{key:"_encodeStartLongPollCommand",value:function(e){u("Codec._encodeStartLongPollCommand"),s(e,"command");var t={id:"StartLongPoll"};return t}},{key:"_decodeStartLongPollCommand",value:function(e){return u("Codec._decodeStartLongPollCommand"),s(e,"jsonCommand"),new pe}},{key:"_encodeValueChangedCommand",value:function(e){u("Codec.encodeValueChangedCommand"),s(e,"command"),s(e.attributeId,"command.attributeId");var t={id:"ValueChanged"};return t.a_id=e.attributeId,l(e.newValue)&&(t.v=e.newValue),t}},{key:"_decodeValueChangedCommand",value:function(e){u("Codec.decodeValueChangedCommand"),s(e,"jsonCommand"),s(e.a_id,"jsonCommand[ATTRIBUTE_ID]");var t=new W;return t.attributeId=e.a_id,l(e.v)?t.newValue=e.v:t.newValue=null,t}},{key:"encode",value:function(e){u("Codec.encode"),s(e,"commands");var t=this;return JSON.stringify(e.map((function(e){if("AttributeMetadataChanged"===e.id)return t._encodeAttributeMetadataChangedCommand(e);if("CallAction"===e.id)return t._encodeCallActionCommand(e);if("ChangeAttributeMetadata"===e.id)return t._encodeChangeAttributeMetadataCommand(e);if("CreateContext"===e.id)return t._encodeCreateContextCommand(e);if("CreateController"===e.id)return t._encodeCreateControllerCommand(e);if("CreatePresentationModel"===e.id)return t._encodeCreatePresentationModelCommand(e);if("DeletePresentationModel"===e.id)return t._encodeDeletePresentationModelCommand(e);if("DestroyContext"===e.id)return t._encodeDestroyContextCommand(e);if("DestroyController"===e.id)return t._encodeDestroyControllerCommand(e);if("InterruptLongPoll"===e.id)return t._encodeInterruptLongPollCommand(e);if("PresentationModelDeleted"===e.id)return t._encodePresentationModelDeletedCommand(e);if("StartLongPoll"===e.id)return t._encodeStartLongPollCommand(e);if("ValueChanged"===e.id)return t._encodeValueChangedCommand(e);throw new we("Command of type "+e.id+" can not be handled")})))}},{key:"decode",value:function(e){if(u("Codec.decode"),s(e,"transmitted"),"string"===Re(e)){var t=this;return JSON.parse(e).map((function(e){if("AttributeMetadataChanged"===e.id)return t._decodeAttributeMetadataChangedCommand(e);if("CallAction"===e.id)return t._decodeCallActionCommand(e);if("ChangeAttributeMetadata"===e.id)return t._decodeChangeAttributeMetadataCommand(e);if("CreateContext"===e.id)return t._decodeCreateContextCommand(e);if("CreateController"===e.id)return t._decodeCreateControllerCommand(e);if("CreatePresentationModel"===e.id)return t._decodeCreatePresentationModelCommand(e);if("DeletePresentationModel"===e.id)return t._decodeDeletePresentationModelCommand(e);if("DestroyContext"===e.id)return t._decodeDestroyContextCommand(e);if("DestroyController"===e.id)return t._decodeDestroyControllerCommand(e);if("InterruptLongPoll"===e.id)return t._decodeInterruptLongPollCommand(e);if("PresentationModelDeleted"===e.id)return t._decodePresentationModelDeletedCommand(e);if("StartLongPoll"===e.id)return t._decodeStartLongPollCommand(e);if("ValueChanged"===e.id)return t._decodeValueChangedCommand(e);throw new we("Command of type "+e.id+" can not be handled")}))}throw new we("Can not decode data that is not of type string")}}],(n=null)&&Te(t.prototype,n),r&&Te(t,r),e}();function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventHandlers=[]}var t,n,r;return t=e,(n=[{key:"onEvent",value:function(e){this.eventHandlers.push(e)}},{key:"trigger",value:function(e){this.eventHandlers.forEach((function(t){return t(e)}))}}])&&Ae(t.prototype,n),r&&Ae(t,r),e}();function _e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Me=0,Oe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.presentationModelType=n,this.attributes=[],this.clientSideOnly=!1,this.dirty=!1,this.id=void 0!==t&&null!=t?t:(Me++).toString(),this.invalidBus=new Pe,this.dirtyValueChangeBus=new Pe}var t,n,r;return t=e,(n=[{key:"copy",value:function(){var t=new e(null,this.presentationModelType);return t.clientSideOnly=!0,this.getAttributes().forEach((function(e){var n=e.copy();t.addAttribute(n)})),t}},{key:"addAttributes",value:function(e){var t=this;!e||e.length<1||e.forEach((function(e){t.addAttribute(e)}))}},{key:"addAttribute",value:function(e){var t=this;if(e&&!(this.attributes.indexOf(e)>-1)){if(this.findAttributeByPropertyName(e.propertyName))throw new Error("There already is an attribute with property name: "+e.propertyName+" in presentation model with id: "+this.id);if(e.getQualifier()&&this.findAttributeByQualifier(e.getQualifier()))throw new Error("There already is an attribute with qualifier: "+e.getQualifier()+" in presentation model with id: "+this.id);e.setPresentationModel(this),this.attributes.push(e),e.onValueChange((function(){t.invalidBus.trigger({source:t})}))}}},{key:"onInvalidated",value:function(e){this.invalidBus.onEvent(e)}},{key:"getAttributes",value:function(){return this.attributes.slice(0)}},{key:"getAt",value:function(e){return this.findAttributeByPropertyName(e)}},{key:"findAllAttributesByPropertyName",value:function(e){var t=[];return e?(this.attributes.forEach((function(n){n.propertyName==e&&t.push(n)})),t):null}},{key:"findAttributeByPropertyName",value:function(e){if(!e)return null;for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].propertyName==e)return this.attributes[t];return null}},{key:"findAttributeByQualifier",value:function(e){if(!e)return null;for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].getQualifier()==e)return this.attributes[t];return null}},{key:"findAttributeById",value:function(e){if(!e)return null;for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].id==e)return this.attributes[t];return null}},{key:"syncWith",value:function(e){this.attributes.forEach((function(t){var n=e.getAt(t.propertyName);n&&t.syncWith(n)}))}}])&&_e(t.prototype,n),r&&_e(t,r),e}();function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ne=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50;Ie(this,e),this.commandQueue=[],this.currentlySending=!1,this.pushEnabled=!1,this.waiting=!1,this.transmitter=t,this.clientDolphin=n,this.slackMS=r,this.codec=new ke,this.commandBatcher=new Y(!0,o)}var t,n,r;return t=e,(n=[{key:"setCommandBatcher",value:function(e){this.commandBatcher=e}},{key:"setPushEnabled",value:function(e){this.pushEnabled=e}},{key:"setPushListener",value:function(e){this.pushListener=e}},{key:"setReleaseCommand",value:function(e){this.releaseCommand=e}},{key:"send",value:function(e,t){this.commandQueue.push({command:e,handler:t}),this.currentlySending?this.release():this.doSendNext()}},{key:"doSendNext",value:function(){var e=this;if(this.commandQueue.length<1){if(!this.pushEnabled)return void(this.currentlySending=!1);this.enqueuePushCommand()}this.currentlySending=!0;var t=this.commandBatcher.batch(this.commandQueue);if(t.length>0){var n=t[t.length-1].handler,r=t.map((function(e){return e.command}));this.transmitter.transmit(r,(function(t){var r=[];t.forEach((function(t){var n=e.handle(t);n&&r.push(n)})),n&&n.onFinished(r),setTimeout((function(){return e.doSendNext()}),e.slackMS)}),(function(e){n.onError(e)}))}else setTimeout((function(){return e.doSendNext()}),this.slackMS)}},{key:"handle",value:function(t){return"DeletePresentationModel"===t.id?this.handleDeletePresentationModelCommand(t):"CreatePresentationModel"===t.id?this.handleCreatePresentationModelCommand(t):"ValueChanged"===t.id?this.handleValueChangedCommand(t):"AttributeMetadataChanged"===t.id?this.handleAttributeMetadataChangedCommand(t):(e.LOGGER.error("Cannot handle, unknown command "+t),null)}},{key:"handleDeletePresentationModelCommand",value:function(e){var t=this.clientDolphin.findPresentationModelById(e.pmId);return t?(this.clientDolphin.getClientModelStore().deletePresentationModel(t,!0),t):null}},{key:"handleCreatePresentationModelCommand",value:function(e){var t=this;if(this.clientDolphin.getClientModelStore().containsPresentationModel(e.pmId))throw new Error("There already is a presentation model with id "+e.pmId+"  known to the client.");var n=[];e.attributes.forEach((function(e){var r=t.clientDolphin.attribute(e.propertyName,e.qualifier,e.value);e.id&&e.id.match(".*S$")&&(r.id=e.id),n.push(r)}));var r=new Oe(e.pmId,e.pmType);return r.addAttributes(n),e.clientSideOnly&&(r.clientSideOnly=!0),this.clientDolphin.getClientModelStore().add(r,!1),this.clientDolphin.updatePresentationModelQualifier(r),r}},{key:"handleValueChangedCommand",value:function(t){var n=this.clientDolphin.getClientModelStore().findAttributeById(t.attributeId);return n?(n.getValue()===t.newValue||n.setValueFromServer(t.newValue),null):(e.LOGGER.error("attribute with id "+t.attributeId+" not found, cannot update to new value "+t.newValue),null)}},{key:"handleAttributeMetadataChangedCommand",value:function(e){var t=this.clientDolphin.getClientModelStore().findAttributeById(e.attributeId);return t?(t[e.metadataName]=e.value,null):null}},{key:"listen",value:function(){this.pushEnabled&&(this.waiting||this.currentlySending||this.doSendNext())}},{key:"enqueuePushCommand",value:function(){var e=this;this.waiting=!0,this.commandQueue.push({command:this.pushListener,handler:{onFinished:function(){e.waiting=!1},onFinishedData:null}})}},{key:"release",value:function(){this.waiting&&(this.waiting=!1,this.transmitter.signal(this.releaseCommand))}}])&&Se(t.prototype,n),r&&Se(t,r),e}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ne.LOGGER=C.getLogger("ClientConnector");var He=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertyName=t,this.id=e.clientAttributeInstanceCount+++"C",this.valueChangeBus=new Pe,this.qualifierChangeBus=new Pe,this.setValue(r),this.setQualifier(n)}var t,n,r;return t=e,r=[{key:"checkValue",value:function(t){if(null==t||void 0===t)return null;var n=t;(n instanceof String||n instanceof Boolean||n instanceof Number)&&(n=t.valueOf()),n instanceof e&&(e.LOGGER.warn("An Attribute may not itself contain an attribute as a value. Assuming you forgot to call value."),n=this.checkValue(t.value));var r=!1;if((this.SUPPORTED_VALUE_TYPES.indexOf(Le(n))>-1||n instanceof Date)&&(r=!0),!r)throw new Error("Attribute values of this type are not allowed: "+Le(t));return n}}],(n=[{key:"copy",value:function(){return new e(this.propertyName,this.getQualifier(),this.getValue())}},{key:"setPresentationModel",value:function(e){if(this.presentationModel)throw new Error("You can not set a presentation model for an attribute that is already bound.");this.presentationModel=e}},{key:"getPresentationModel",value:function(){return this.presentationModel}},{key:"getValue",value:function(){return this.value}},{key:"setValueFromServer",value:function(t){var n=e.checkValue(t);if(this.value!==n){var r=this.value;this.value=n,this.valueChangeBus.trigger({oldValue:r,newValue:n,sendToServer:!1})}}},{key:"setValue",value:function(t){var n=e.checkValue(t);if(this.value!==n){var r=this.value;this.value=n,this.valueChangeBus.trigger({oldValue:r,newValue:n,sendToServer:!0})}}},{key:"setQualifier",value:function(e){if(this.qualifier!==e){var t=this.qualifier;this.qualifier=e,this.qualifierChangeBus.trigger({oldValue:t,newValue:e}),this.valueChangeBus.trigger({oldValue:this.value,newValue:this.value,sendToServer:!1})}}},{key:"getQualifier",value:function(){return this.qualifier}},{key:"onValueChange",value:function(e){this.valueChangeBus.onEvent(e),e({oldValue:this.value,newValue:this.value,sendToServer:!1})}},{key:"onQualifierChange",value:function(e){this.qualifierChangeBus.onEvent(e)}},{key:"syncWith",value:function(e){e&&(this.setQualifier(e.getQualifier()),this.setValue(e.value))}}])&&De(t.prototype,n),r&&De(t,r),e}();function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}He.LOGGER=C.getLogger("ClientAttribute"),He.SUPPORTED_VALUE_TYPES=["string","number","boolean"],He.clientAttributeInstanceCount=0;var Ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"setClientConnector",value:function(e){this.clientConnector=e}},{key:"getClientConnector",value:function(){return this.clientConnector}},{key:"send",value:function(e,t){this.clientConnector.send(e,t)}},{key:"attribute",value:function(e,t,n){return new He(e,t,n)}},{key:"presentationModel",value:function(e,t){for(var n=new Oe(e,t),r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return o&&o.length>0&&o.forEach((function(e){n.addAttribute(e)})),this.getClientModelStore().add(n,!0),n}},{key:"setClientModelStore",value:function(e){this.clientModelStore=e}},{key:"getClientModelStore",value:function(){return this.clientModelStore}},{key:"listPresentationModelIds",value:function(){return this.getClientModelStore().listPresentationModelIds()}},{key:"listPresentationModels",value:function(){return this.getClientModelStore().listPresentationModels()}},{key:"findAllPresentationModelByType",value:function(e){return this.getClientModelStore().findAllPresentationModelByType(e)}},{key:"getAt",value:function(e){return this.findPresentationModelById(e)}},{key:"findPresentationModelById",value:function(e){return this.getClientModelStore().findPresentationModelById(e)}},{key:"deletePresentationModel",value:function(e){this.getClientModelStore().deletePresentationModel(e,!0)}},{key:"updatePresentationModelQualifier",value:function(e){var t=this;e.getAttributes().forEach((function(e){t.updateAttributeQualifier(e)}))}},{key:"updateAttributeQualifier",value:function(e){e.getQualifier()&&this.getClientModelStore().findAllAttributesByQualifier(e.getQualifier()).forEach((function(t){t.setValue(e.getValue())}))}},{key:"startPushListening",value:function(e,t){var n=this;this.clientConnector.setPushListener(e),this.clientConnector.setReleaseCommand(t),this.clientConnector.setPushEnabled(!0),setTimeout((function(){n.clientConnector.listen()}),0)}},{key:"stopPushListening",value:function(){this.clientConnector.setPushEnabled(!1)}}])&&Be(t.prototype,n),r&&Be(t,r),e}();var Ue=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ue.QUALIFIER_PROPERTY="qualifier",Ue.VALUE="value";var je=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"createCreateContextCommand",value:function(){return new te}},{key:"createCreateControllerCommand",value:function(e,t){var n=new re;return n.init(e,t),n}},{key:"createCallActionCommand",value:function(e,t,n){var r=new J;return r.init(e,t,n),r}},{key:"createDestroyControllerCommand",value:function(e){var t=new ce;return t.init(e),t}},{key:"createDestroyContextCommand",value:function(){return new ue}},{key:"createStartLongPollCommand",value:function(){return new pe}},{key:"createInterruptLongPollCommand",value:function(){return new de}},{key:"createCreatePresentationModelCommand",value:function(e){var t=new ae;return t.init(e),t}},{key:"createDeletePresentationModelCommand",value:function(e){var t=new le;return t.init(e),t}},{key:"createPresentationModelDeletedCommand",value:function(e){var t=new he;return t.init(e),t}},{key:"createValueChangedCommand",value:function(e,t){var n=new W;return n.init(e,t),n}},{key:"createChangeAttributeMetadataCommand",value:function(e,t,n){var r=new ee;return r.init(e,t,n),r}},{key:"createAttributeMetadataChangedCommand",value:function(e,t,n){var r=new z;return r.init(e,t,n),r}}],(n=null)&&xe(t.prototype,n),r&&xe(t,r),e}();function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var qe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clientDolphin=t,this.presentationModels=new Map,this.presentationModelsPerType=new Map,this.attributesPerId=new Map,this.attributesPerQualifier=new Map,this.modelStoreChangeBus=new Pe}var t,n,r;return t=e,(n=[{key:"getClientDolphin",value:function(){return this.clientDolphin}},{key:"registerAttribute",value:function(e){var t=this;this.addAttributeById(e),e.getQualifier()&&this.addAttributeByQualifier(e),e.onValueChange((function(n){if(n.newValue!==n.oldValue&&!0===n.sendToServer){var r=je.createValueChangedCommand(e.id,n.newValue);t.clientDolphin.getClientConnector().send(r,null)}e.getQualifier()&&t.findAttributesByFilter((function(t){return t!==e&&t.getQualifier()===e.getQualifier()})).forEach((function(t){t.setValue(e.getValue())}))})),e.onQualifierChange((function(n){t.clientDolphin.getClientConnector().send(je.createChangeAttributeMetadataCommand(e.id,Ue.QUALIFIER_PROPERTY,n.newValue),null)}))}},{key:"add",value:function(t){var n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return!1;this.presentationModels.has(t.id)&&e.LOGGER.error("There already is a PM with id "+t.id);var o=!1;if(!this.presentationModels.has(t.id)){if(this.presentationModels.set(t.id,t),this.addPresentationModelByType(t),r){var a=this.clientDolphin.getClientConnector();a.send(je.createCreatePresentationModelCommand(t),null)}t.getAttributes().forEach((function(e){n.registerAttribute(e)})),this.modelStoreChangeBus.trigger({eventType:"ADDED",clientPresentationModel:t}),o=!0}return o}},{key:"remove",value:function(e){var t=this;if(!e)return!1;var n=!1;return this.presentationModels.has(e.id)&&(this.removePresentationModelByType(e),this.presentationModels.delete(e.id),e.getAttributes().forEach((function(e){t.removeAttributeById(e),e.getQualifier()&&t.removeAttributeByQualifier(e)})),this.modelStoreChangeBus.trigger({eventType:"REMOVED",clientPresentationModel:e}),n=!0),n}},{key:"findAttributesByFilter",value:function(e){var t=[];return this.presentationModels.forEach((function(n){n.getAttributes().forEach((function(n){e(n)&&t.push(n)}))})),t}},{key:"addPresentationModelByType",value:function(e){if(e){var t=e.presentationModelType;if(t){var n=this.presentationModelsPerType.get(t);n||(n=[],this.presentationModelsPerType.set(t,n)),n.indexOf(e)>-1||n.push(e)}}}},{key:"removePresentationModelByType",value:function(e){if(e&&e.presentationModelType){var t=this.presentationModelsPerType.get(e.presentationModelType);t&&(t.length>-1&&t.splice(t.indexOf(e),1),0===t.length&&this.presentationModelsPerType.delete(e.presentationModelType))}}},{key:"listPresentationModelIds",value:function(){for(var e=[],t=this.presentationModels.keys(),n=t.next();!n.done;)e.push(n.value),n=t.next();return e}},{key:"listPresentationModels",value:function(){for(var e=[],t=this.presentationModels.values(),n=t.next();!n.done;)e.push(n.value),n=t.next();return e}},{key:"findPresentationModelById",value:function(e){return this.presentationModels.get(e)}},{key:"findAllPresentationModelByType",value:function(e){return e&&this.presentationModelsPerType.has(e)?this.presentationModelsPerType.get(e).slice(0):[]}},{key:"deletePresentationModel",value:function(e,t){if(e&&this.containsPresentationModel(e.id)){if(this.remove(e),!t||e.clientSideOnly)return;this.clientDolphin.getClientConnector().send(je.createPresentationModelDeletedCommand(e.id),null)}}},{key:"containsPresentationModel",value:function(e){return this.presentationModels.has(e)}},{key:"addAttributeById",value:function(e){e&&!this.attributesPerId.has(e.id)&&this.attributesPerId.set(e.id,e)}},{key:"removeAttributeById",value:function(e){e&&this.attributesPerId.has(e.id)&&this.attributesPerId.delete(e.id)}},{key:"findAttributeById",value:function(e){return this.attributesPerId.get(e)}},{key:"addAttributeByQualifier",value:function(e){if(e&&e.getQualifier()){var t=this.attributesPerQualifier.get(e.getQualifier());t||(t=[],this.attributesPerQualifier.set(e.getQualifier(),t)),t.indexOf(e)>-1||t.push(e)}}},{key:"removeAttributeByQualifier",value:function(e){if(e&&e.getQualifier()){var t=this.attributesPerQualifier.get(e.getQualifier());t&&(t.length>-1&&t.splice(t.indexOf(e),1),0===t.length&&this.attributesPerQualifier.delete(e.getQualifier()))}}},{key:"findAllAttributesByQualifier",value:function(e){return e&&this.attributesPerQualifier.has(e)?this.attributesPerQualifier.get(e).slice(0):[]}},{key:"onModelStoreChange",value:function(e){this.modelStoreChangeBus.onEvent(e)}},{key:"onModelStoreChangeForType",value:function(e,t){this.modelStoreChangeBus.onEvent((function(n){n.clientPresentationModel.presentationModelType==e&&t(n)}))}}])&&Ve(t.prototype,n),r&&Ve(t,r),e}();function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}qe.LOGGER=C.getLogger("ClientModelStore");var Qe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"transmit",value:function(e,t){t([])}},{key:"signal",value:function(){}},{key:"reset",value:function(){}}])&&Fe(t.prototype,n),r&&Fe(t,r),e}();function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.slackMS=300,this.maxBatchSize=50,this.transmitter=null}var t,n,r;return t=e,(n=[{key:"withSlackMS",value:function(e){return this.slackMS=e,this}},{key:"withMaxBatchSize",value:function(e){return this.maxBatchSize=e,this}},{key:"withTransmitter",value:function(e){return this.transmitter=e,this}},{key:"build",value:function(){var t,n=new Ge;return t=this.transmitter?this.transmitter:new Qe,n.setClientConnector(new Ne(t,n,this.slackMS,this.maxBatchSize)),n.setClientModelStore(new qe(n)),e.LOGGER.debug("Remoting client initialized",n,t),n}}])&&Ye(t.prototype,n),r&&Ye(t,r),e}();Xe.LOGGER=C.getLogger("DolphinBuilder");var We=new Xe;function Ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ze="@@@ CONTROLLER_ACTION_CALL_BEAN @@@",Ze=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("Connector(url, dolphin, classRepository, config)"),s(t,"url"),s(n,"dolphin"),s(r,"classRepository");var a=this;this.dolphin=n,this.config=o,this.classRepository=r,this.highlanderPMResolver=function(){},this.highlanderPMPromise=new Promise((function(e){a.highlanderPMResolver=e})),n.getClientModelStore().onModelStoreChange((function(e){var t=e.clientPresentationModel,n=t.findAttributeByPropertyName("@@@ SOURCE_SYSTEM @@@");l(n)&&"server"===n.value&&("ADDED"===e.eventType?a.onModelAdded(t):"REMOVED"===e.eventType&&a.onModelRemoved(t))}))}var t,n,r;return t=e,(n=[{key:"connect",value:function(){this.dolphin.startPushListening(je.createStartLongPollCommand(),je.createInterruptLongPollCommand())}},{key:"onModelAdded",value:function(e){switch(u("Connector.onModelAdded(model)"),s(e,"model"),e.presentationModelType){case ze:break;case"@@@ R_BEAN @@@":this.classRepository.registerClass(e);break;case"@@@ HIGHLANDER_BEAN @@@":this.highlanderPMResolver(e);break;case"@R:LS@":this.classRepository.spliceListEntry(e),this.dolphin.deletePresentationModel(e);break;default:this.classRepository.load(e)}}},{key:"onModelRemoved",value:function(e){switch(u("Connector.onModelRemoved(model)"),s(e,"model"),e.presentationModelType){case"@@@ R_BEAN @@@":this.classRepository.unregisterClass(e);break;case"@R:LS@":break;default:this.classRepository.unload(e)}}},{key:"invoke",value:function(e){u("Connector.invoke(command)"),s(e,"command");var t=this.dolphin;return new Promise((function(n,r){t.send(e,{onFinished:function(e){n(e)},onError:function(e){r(e)}})}))}},{key:"getHighlanderPM",value:function(){return this.highlanderPMPromise}}])&&Ke(t.prototype,n),r&&Ke(t,r),e}();function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $e=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("BeanManager(classRepository)"),s(t,"classRepository"),this.classRepository=t,this.addedHandlers=new Map,this.removedHandlers=new Map,this.updatedHandlers=new Map,this.arrayUpdatedHandlers=new Map,this.allAddedHandlers=[],this.allRemovedHandlers=[],this.allUpdatedHandlers=[],this.allArrayUpdatedHandlers=[],this._handleBeanAdded=this._handleBeanAdded.bind(this),this._handleBeanRemoved=this._handleBeanRemoved.bind(this),this._handleBeanUpdate=this._handleBeanUpdate.bind(this),this._handleArrayUpdate=this._handleArrayUpdate.bind(this),this.classRepository.onBeanAdded(this._handleBeanAdded),this.classRepository.onBeanRemoved(this._handleBeanRemoved),this.classRepository.onBeanUpdate(this._handleBeanUpdate),this.classRepository.onArrayUpdate(this._handleArrayUpdate)}var t,n,r;return t=e,(n=[{key:"_handleBeanAdded",value:function(t,n){var r=this.addedHandlers.get(t);l(r)&&r.forEach((function(r){try{r(n)}catch(n){e.LOGGER.error("An exception occurred while calling an onBeanAdded-handler for type",t,n)}})),this.allAddedHandlers.forEach((function(t){try{t(n)}catch(t){e.LOGGER.error("An exception occurred while calling a general onBeanAdded-handler",t)}}))}},{key:"_handleBeanRemoved",value:function(t,n){var r=this.removedHandlers.get(t);l(r)&&r.forEach((function(r){try{r(n)}catch(n){e.LOGGER.error("An exception occurred while calling an onBeanRemoved-handler for type",t,n)}})),this.allRemovedHandlers.forEach((function(t){try{t(n)}catch(t){e.LOGGER.error("An exception occurred while calling a general onBeanRemoved-handler",t)}}))}},{key:"_handleArrayUpdate",value:function(t,n,r,o,a,i){var u=this.arrayUpdatedHandlers.get(t);l(u)&&u.forEach((function(l){try{l(n,r,o,a,i)}catch(n){e.LOGGER.error("An exception occurred while calling an onArrayUpdate-handler for type",t,n)}})),this.allArrayUpdatedHandlers.forEach((function(t){try{t(n,r,o,a,i)}catch(t){e.LOGGER.error("An exception occurred while calling a general onArrayUpdate-handler",t)}}))}},{key:"_handleBeanUpdate",value:function(t,n,r,o,a){var i=this.updatedHandlers.get(t);l(i)&&i.forEach((function(i){try{i(n,r,o,a)}catch(n){e.LOGGER.error("An exception occurred while calling an onBeanUpdate-handler for type",t,n)}})),this.allUpdatedHandlers.forEach((function(t){try{t(n,r,o,a)}catch(t){e.LOGGER.error("An exception occurred while calling a general onBeanUpdate-handler",t)}}))}},{key:"notifyBeanChange",value:function(e,t,n){return u("BeanManager.notifyBeanChange(bean, propertyName, newValue)"),s(e,"bean"),s(t,"propertyName"),this.classRepository.notifyBeanChange(e,t,n)}},{key:"notifyArrayChange",value:function(e,t,n,r,o){u("BeanManager.notifyArrayChange(bean, propertyName, index, count, removedElements)"),s(e,"bean"),s(t,"propertyName"),s(n,"index"),s(r,"count"),s(o,"removedElements"),this.classRepository.notifyArrayChange(e,t,n,r,o)}},{key:"isManaged",value:function(e){throw u("BeanManager.isManaged(bean)"),s(e,"bean"),new Error("Not implemented yet")}},{key:"create",value:function(e){throw u("BeanManager.create(type)"),s(e,"type"),new Error("Not implemented yet")}},{key:"add",value:function(e,t){throw u("BeanManager.add(type, bean)"),s(e,"type"),s(t,"bean"),new Error("Not implemented yet")}},{key:"addAll",value:function(e,t){throw u("BeanManager.addAll(type, collection)"),s(e,"type"),s(t,"collection"),new Error("Not implemented yet")}},{key:"remove",value:function(e){throw u("BeanManager.remove(bean)"),s(e,"bean"),new Error("Not implemented yet")}},{key:"removeAll",value:function(e){throw u("BeanManager.removeAll(collection)"),s(e,"collection"),new Error("Not implemented yet")}},{key:"removeIf",value:function(e){throw u("BeanManager.removeIf(predicate)"),s(e,"predicate"),new Error("Not implemented yet")}},{key:"onAdded",value:function(e,t){var n=this;if(l(t)){u("BeanManager.onAdded(type, eventHandler)"),s(e,"type"),s(t,"eventHandler");var r=this.addedHandlers.get(e);return l(r)||(r=[]),this.addedHandlers.set(e,r.concat(t)),{unsubscribe:function(){var r=n.addedHandlers.get(e);l(r)&&n.addedHandlers.set(e,r.filter((function(e){return e!==t})))}}}return t=e,u("BeanManager.onAdded(eventHandler)"),s(t,"eventHandler"),this.allAddedHandlers=this.allAddedHandlers.concat(t),{unsubscribe:function(){n.allAddedHandlers=n.allAddedHandlers.filter((function(e){return e!==t}))}}}},{key:"onRemoved",value:function(e,t){var n=this;if(l(t)){u("BeanManager.onRemoved(type, eventHandler)"),s(e,"type"),s(t,"eventHandler");var r=this.removedHandlers.get(e);return l(r)||(r=[]),this.removedHandlers.set(e,r.concat(t)),{unsubscribe:function(){var r=n.removedHandlers.get(e);l(r)&&n.removedHandlers.set(e,r.filter((function(e){return e!==t})))}}}return t=e,u("BeanManager.onRemoved(eventHandler)"),s(t,"eventHandler"),this.allRemovedHandlers=this.allRemovedHandlers.concat(t),{unsubscribe:function(){n.allRemovedHandlers=n.allRemovedHandlers.filter((function(e){return e!==t}))}}}},{key:"onBeanUpdate",value:function(e,t){var n=this;if(l(t)){u("BeanManager.onBeanUpdate(type, eventHandler)"),s(e,"type"),s(t,"eventHandler");var r=this.updatedHandlers.get(e);return l(r)||(r=[]),this.updatedHandlers.set(e,r.concat(t)),{unsubscribe:function(){var r=n.updatedHandlers.get(e);l(r)&&n.updatedHandlers.set(e,r.filter((function(e){return e!==t})))}}}return t=e,u("BeanManager.onBeanUpdate(eventHandler)"),s(t,"eventHandler"),this.allUpdatedHandlers=this.allUpdatedHandlers.concat(t),{unsubscribe:function(){n.allUpdatedHandlers=n.allUpdatedHandlers.filter((function(e){return e!==t}))}}}},{key:"onArrayUpdate",value:function(e,t){var n=this;if(l(t)){u("BeanManager.onArrayUpdate(type, eventHandler)"),s(e,"type"),s(t,"eventHandler");var r=this.arrayUpdatedHandlers.get(e);return l(r)||(r=[]),this.arrayUpdatedHandlers.set(e,r.concat(t)),{unsubscribe:function(){var r=n.arrayUpdatedHandlers.get(e);l(r)&&n.arrayUpdatedHandlers.set(e,r.filter((function(e){return e!==t})))}}}return t=e,u("BeanManager.onArrayUpdate(eventHandler)"),s(t,"eventHandler"),this.allArrayUpdatedHandlers=this.allArrayUpdatedHandlers.concat(t),{unsubscribe:function(){n.allArrayUpdatedHandlers=n.allArrayUpdatedHandlers.filter((function(e){return e!==t}))}}}}])&&Je(t.prototype,n),r&&Je(t,r),e}();function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}$e.LOGGER=C.getLogger("BeanManager");var nt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("ClassRepository(dolphin)"),s(t,"dolphin"),this.dolphin=t,this.classes=new Map,this.beanFromDolphin=new Map,this.beanToDolphin=new Map,this.classInfos=new Map,this.beanAddedHandlers=[],this.beanRemovedHandlers=[],this.propertyUpdateHandlers=[],this.arrayUpdateHandlers=[],this.blocked=null}var t,n,r;return t=e,(n=[{key:"sendListSplice",value:function(t,n,r,o,a,i){var u=t.dolphin,s=u.findPresentationModelById(n);if(l(s)){var c=t.classes.get(s.presentationModelType)[r];if(l(c)){var d=[u.attribute("@@@ SOURCE_SYSTEM @@@",null,"client"),u.attribute("source",null,n),u.attribute("attribute",null,r),u.attribute("from",null,o),u.attribute("to",null,a),u.attribute("count",null,i.length)];i.forEach((function(n,r){d.push(u.attribute(r.toString(),null,e.toDolphin(t,c,n)))})),u.presentationModel.apply(u,[null,"@DP:LS@"].concat(d))}}}},{key:"validateList",value:function(t,n,r,o){l(r[o])||t.propertyUpdateHandlers.forEach((function(t){try{t(n,r,o,[],void 0)}catch(t){e.LOGGER.error("An exception occurred while calling an onBeanUpdate-handler",t)}}))}},{key:"block",value:function(e,t){if(l(this.blocked))throw new Error("Trying to create a block while another block exists");this.blocked={bean:e,propertyName:t}}},{key:"isBlocked",value:function(e,t){return l(this.blocked)&&this.blocked.bean===e&&this.blocked.propertyName===t}},{key:"unblock",value:function(){this.blocked=null}},{key:"notifyBeanChange",value:function(t,n,r){u("ClassRepository.notifyBeanChange(bean, propertyName, newValue)"),s(t,"bean"),s(n,"propertyName");var o=this.beanToDolphin.get(t);if(l(o)){var a=this.dolphin.findPresentationModelById(o);if(l(a)){var i=this.classes.get(a.presentationModelType)[n],c=a.findAttributeByPropertyName(n);if(l(i)&&l(c)){var d=c.getValue();return c.setValue(e.toDolphin(this,i,r)),e.fromDolphin(this,i,d)}}}}},{key:"notifyArrayChange",value:function(e,t,n,r,o){if(u("ClassRepository.notifyArrayChange(bean, propertyName, index, count, removedElements)"),s(e,"bean"),s(t,"propertyName"),s(n,"index"),s(r,"count"),s(o,"removedElements"),!this.isBlocked(e,t)){var a=this.beanToDolphin.get(e),i=e[t];if(l(a)&&l(i)){var c=Array.isArray(o)?o.length:0;this.sendListSplice(this,a,t,n,n+c,i.slice(n,n+r))}}}},{key:"onBeanAdded",value:function(e){u("ClassRepository.onBeanAdded(handler)"),s(e,"handler"),this.beanAddedHandlers.push(e)}},{key:"onBeanRemoved",value:function(e){u("ClassRepository.onBeanRemoved(handler)"),s(e,"handler"),this.beanRemovedHandlers.push(e)}},{key:"onBeanUpdate",value:function(e){u("ClassRepository.onBeanUpdate(handler)"),s(e,"handler"),this.propertyUpdateHandlers.push(e)}},{key:"onArrayUpdate",value:function(e){u("ClassRepository.onArrayUpdate(handler)"),s(e,"handler"),this.arrayUpdateHandlers.push(e)}},{key:"registerClass",value:function(e){if(u("ClassRepository.registerClass(model)"),s(e,"model"),!this.classes.has(e.id)){var t={};e.attributes.filter((function(e){return e.propertyName.search(/^@/)<0})).forEach((function(e){t[e.propertyName]=e.value})),this.classes.set(e.id,t)}}},{key:"unregisterClass",value:function(e){u("ClassRepository.unregisterClass(model)"),s(e,"model"),this.classes.delete(e.id)}},{key:"load",value:function(t){u("ClassRepository.load(model)"),s(t,"model");var n=this,r=this.classes.get(t.presentationModelType),o={};return t.attributes.filter((function(e){return e.propertyName.search(/^@/)<0})).forEach((function(a){o[a.propertyName]=null,a.onValueChange((function(i){if(i.oldValue!==i.newValue){var l=e.fromDolphin(n,r[a.propertyName],i.oldValue),u=e.fromDolphin(n,r[a.propertyName],i.newValue);n.propertyUpdateHandlers.forEach((function(n){try{n(t.presentationModelType,o,a.propertyName,u,l)}catch(t){e.LOGGER.error("An exception occurred while calling an onBeanUpdate-handler",t)}}))}}))})),this.beanFromDolphin.set(t.id,o),this.beanToDolphin.set(o,t.id),this.classInfos.set(t.id,r),this.beanAddedHandlers.forEach((function(n){try{n(t.presentationModelType,o)}catch(t){e.LOGGER.error("An exception occurred while calling an onBeanAdded-handler",t)}})),o}},{key:"unload",value:function(t){u("ClassRepository.unload(model)"),s(t,"model");var n=this.beanFromDolphin.get(t.id);return this.beanFromDolphin.delete(t.id),this.beanToDolphin.delete(n),this.classInfos.delete(t.id),l(n)&&this.beanRemovedHandlers.forEach((function(r){try{r(t.presentationModelType,n)}catch(t){e.LOGGER.error("An exception occurred while calling an onBeanRemoved-handler",t)}})),n}},{key:"spliceListEntry",value:function(t){u("ClassRepository.spliceListEntry(model)"),s(t,"model");var n=t.findAttributeByPropertyName("source"),r=t.findAttributeByPropertyName("attribute"),o=t.findAttributeByPropertyName("from"),a=t.findAttributeByPropertyName("to"),i=t.findAttributeByPropertyName("count");if(!(l(n)&&l(r)&&l(o)&&l(a)&&l(i)))throw new Error("Invalid list modification update received");var c=this.classInfos.get(n.value),d=this.beanFromDolphin.get(n.value);if(!l(d)||!l(c))throw new Error("Invalid list modification update received. Source bean unknown.");var f=t.presentationModelType;this.validateList(this,f,d,r.value);for(var h=[],p=null,v=0;v<i.value;v++){if(!l(p=t.findAttributeByPropertyName(v.toString())))throw new Error("Invalid list modification update received");h.push(e.fromDolphin(this,c[r.value],p.value))}try{this.block(d,r.value),this.arrayUpdateHandlers.forEach((function(t){try{t(f,d,r.value,o.value,a.value-o.value,h)}catch(t){e.LOGGER.error("An exception occurred while calling an onArrayUpdate-handler",t)}}))}finally{this.unblock()}}},{key:"mapParamToDolphin",value:function(e){if(!l(e))return e;var t=et(e);if("object"===t){if(e instanceof Date)return e.toISOString();var n=this.beanToDolphin.get(e);if(l(n))return n;throw new TypeError("Only managed remoting beans can be used")}if("string"===t||"number"===t||"boolean"===t)return e;throw new TypeError("Only managed remoting beans and primitive types can be used")}},{key:"mapDolphinToBean",value:function(t){return e.fromDolphin(this,0,t)}}])&&tt(t.prototype,n),r&&tt(t,r),e}();nt.fixType=function(e,t){switch(e){case 1:case 2:case 3:case 4:return parseInt(t);case 5:case 6:return parseFloat(t);case 7:return"true"===String(t).toLowerCase();case 8:case 10:return String(t);default:return t}},nt.fromDolphin=function(e,t,n){if(!l(n))return null;switch(t){case 0:return e.beanFromDolphin.get(String(n));case 9:case 11:case 55:case 52:case 54:return new Date(String(n));default:return nt.fixType(t,n)}},nt.toDolphin=function(e,t,n){if(!l(n))return null;switch(t){case 0:return e.beanToDolphin.get(n);case 9:case 11:case 55:case 52:case 54:return n instanceof Date?n.toISOString():n;default:return nt.fixType(t,n)}},nt.LOGGER=C.getLogger("ClassRepository");var rt=nt;function ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var at=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("ControllerProxy(controllerId, model, manager)"),s(t,"controllerId"),s(n,"model"),s(r,"manager"),this.controllerId=t,this.model=n,this.manager=r,this.destroyed=!1,this.onDestroyedHandlers=new Set}var t,n,r;return t=e,(n=[{key:"getModel",value:function(){return this.model}},{key:"getId",value:function(){return this.controllerId}},{key:"invoke",value:function(e,t){if(u("ControllerProxy.invoke(name, params)"),s(e,"name"),this.destroyed)throw new Error("The controller was already destroyed");return this.manager.invokeAction(this.controllerId,e,t)}},{key:"createController",value:function(e){return this.manager._createController(e,this.getId())}},{key:"destroy",value:function(){var t=this;if(this.destroyed)throw new Error("The controller was already destroyed");return this.destroyed=!0,this.onDestroyedHandlers.forEach((function(n){try{n(t)}catch(t){e.LOGGER.error("An exception occurred while calling an onDestroyed-handler",t)}}),this),this.manager.destroyController(this)}},{key:"onDestroyed",value:function(e){u("ControllerProxy.onDestroyed(handler)"),s(e,"handler");var t=this;return this.onDestroyedHandlers.add(e),{unsubscribe:function(){t.onDestroyedHandlers.delete(e)}}}}])&&ot(t.prototype,n),r&&ot(t,r),e}();function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}at.LOGGER=C.getLogger("ControllerProxy");var lt=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("ControllerManager(dolphin, classRepository, connector)"),s(t,"dolphin"),s(n,"classRepository"),s(r,"connector"),this.dolphin=t,this.classRepository=n,this.connector=r,this.controllers=new Set}var t,n,r;return t=e,(n=[{key:"createController",value:function(e){return this._createController(e,null)}},{key:"_createController",value:function(e,t){u("ControllerManager.createController(name)"),s(e,"name");var n=this;return new Promise((function(r,o){n.connector.getHighlanderPM().then((function(a){n.connector.invoke(je.createCreateControllerCommand(e,t)).then((function(){var e;n.getValueWithRetry((function(){return a.findAttributeByPropertyName("controllerId").getValue()}),"Could not get an controllerID from highlanderPM.").then((function(t){return e=t,n.getValueWithRetry((function(){return a.findAttributeByPropertyName("model").getValue()}),"Could not get an modelID from highlanderPM.")})).then((function(e){return n.getValueWithRetry((function(){return n.classRepository.mapDolphinToBean(e)}),"Could not get an model from classRepository for ID: "+e)})).then((function(t){try{var a=new at(e,t,n);n.controllers.add(a),r(a)}catch(e){o("Error creating controller: "+e)}})).catch((function(e){o("Error creating controller: "+e)}))})).catch((function(e){o("Error creating controller: "+e)}))}))}))}},{key:"getValueWithRetry",value:function(e,t){return new Promise((function(n,r){var o=0,a=setInterval((function(){var i=e();null==i?++o>=1e3&&(clearInterval(a),r(t+" after "+o+" retries.")):(clearInterval(a),n(i))}),5)}))}},{key:"invokeAction",value:function(e,t,n){u("ControllerManager.invokeAction(controllerId, actionName, params)"),s(e,"controllerId"),s(t,"actionName");var r=this;return new Promise((function(o,a){var i=[r.dolphin.attribute("@@@ SOURCE_SYSTEM @@@",null,"client"),r.dolphin.attribute("errorCode")],u=r.dolphin.presentationModel.apply(r.dolphin,[null,ze].concat(i)),s=[];if(l(n))for(var c in n)if(n.hasOwnProperty(c)){var d=r.classRepository.mapParamToDolphin(n[c]);s.push({name:c,value:d})}r.connector.invoke(je.createCallActionCommand(e,t,s)).then((function(){u.findAttributeByPropertyName("errorCode").getValue()?a(new Error("Server side ControllerAction "+t+" caused an error. Please see server log for details.")):o(),r.dolphin.deletePresentationModel(u)})).catch(a)}))}},{key:"destroyController",value:function(e){u("ControllerManager.destroyController(controller)"),s(e,"controller");var t=this;return new Promise((function(n,r){t.connector.getHighlanderPM().then((function(o){t.controllers.delete(e),o.findAttributeByPropertyName("controllerId").setValue(e.controllerId),t.connector.invoke(je.createDestroyControllerCommand(e.getId())).then(n).catch(r)}))}))}},{key:"destroy",value:function(){var e=this.controllers,t=[];return this.controllers=new Set,e.forEach((function(e){try{t.push(e.destroy())}catch(e){}})),Promise.all(t)}}])&&it(t.prototype,n),r&&it(t,r),e}(),ut=n(0),st=n.n(ut);function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var dt=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u("ClientContext(dolphin, beanManager, controllerManager, connector)"),s(t,"dolphin"),s(n,"beanManager"),s(r,"controllerManager"),s(o,"connector"),this.dolphin=t,this.beanManager=n,this._controllerManager=r,this._connector=o,this.connectionPromise=null,this.isConnected=!1}var t,n,r;return t=e,(n=[{key:"connect",value:function(){var e=this;return this.connectionPromise=new Promise((function(t,n){e._connector.connect(),e._connector.invoke(je.createCreateContextCommand()).then((function(){e.isConnected=!0,t()})).catch(n)})),this.connectionPromise}},{key:"onConnect",value:function(){return l(this.connectionPromise)?this.isConnected?new Promise((function(e){e()})):this.connectionPromise:this.connect()}},{key:"createController",value:function(e){return u("ClientContext.createController(name)"),s(e,"name"),this._controllerManager.createController(e)}},{key:"disconnect",value:function(){var e=this;return this.dolphin.stopPushListening(),new Promise((function(t){e._controllerManager.destroy().then((function(){e._connector.invoke(je.createDestroyContextCommand()),e.dolphin=null,e.beanManager=null,e._controllerManager=null,e._connector=null,t()}))}))}}])&&ct(t.prototype,n),r&&ct(t,r),e}();function ft(e){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}function vt(e){return function(){var t,n=Et(e);if(Ct()){var r=Et(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return yt(this,t)}}function yt(e,t){return!t||"object"!==ft(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mt(e){var t="function"==typeof Map?new Map:void 0;return(mt=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return gt(e,arguments,Et(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),bt(r,e)})(e)}function gt(e,t,n){return(gt=Ct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&bt(o,n.prototype),o}).apply(null,arguments)}function Ct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}st()(dt.prototype);var wt=function(e){pt(n,e);var t=vt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Remoting Error",o=arguments.length>1?arguments[1]:void 0;return ht(this,n),(e=t.call(this,r)).detail=o||void 0,e}return n}(mt(Error)),Rt=function(e){pt(n,e);var t=vt(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Session Error";return ht(this,n),t.call(this,e)}return n}(mt(Error));(function(e){pt(n,e);var t=vt(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Http Response Error";return ht(this,n),t.call(this,e)}})(mt(Error)),function(e){pt(n,e);var t=vt(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Http Network Error";return ht(this,n),t.call(this,e)}}(mt(Error));function Tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var kt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"onError",value:function(t){e.LOGGER.error(t)}}])&&Tt(t.prototype,n),r&&Tt(t,r),e}();function At(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}kt.LOGGER=C.getLogger("RemotingErrorHandler");var Pt=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.config=n,this.client=r,this.headersInfo=l(n)?n.headersInfo:null,this.failed_attempt=0;var o=this._connectionConfig();this.maxRetry=l(o)&&l(o.maxRetry)?o.maxRetry:3,this.timeout=l(o)&&l(o.timeout)?o.timeout:5e3}var t,n,r;return t=e,(n=[{key:"_connectionConfig",value:function(){return l(this.config)?this.config.connection:null}},{key:"_handleError",value:function(e,t){var n=this._connectionConfig();(l(n)&&l(n.errorHandlers)?n.errorHandlers:[new kt]).forEach((function(e){e.onError(t)})),e(t)}},{key:"_send",value:function(t){var n=this,r=this;return new Promise((function(a,i){if(n.client){var l=ke.encode(t);if(e.LOGGER.isLogLevelUseable(o.DEBUG)&&!e.LOGGER.isLogLevelUseable(o.TRACE))for(var u=0;u<t.length;u++){var s=t[u];"ValueChanged"===s.id&&e.LOGGER.debug("send",s,l)}var c=1===t.length&&"StartLongPoll"===t[0].id,d=n.client.getService("HttpClient");d&&r.failed_attempt<=r.maxRetry?d.post(r.url).withHeadersInfo(n.headersInfo).withContent(l).readString().execute(c).then((function(e){a(e.content)})).catch((function(e){var t=e.getStatus();r.failed_attempt+=1,408===t?r._handleError(i,new Rt("PlatformHttpTransmitter: Session Timeout")):r._handleError(i,e)})):e.LOGGER.error("Cannot reach the sever")}else e.LOGGER.error("No Rico client found!")}))}},{key:"transmit",value:function(e,t,n){var r=this;this._send(e).then((function(e){if(e.trim().length>0)try{var o=ke.decode(e);t(o)}catch(t){var a="PlatformHttpTransmitter: Parse error: (Incorrect response = "+e+")";r.emit("error",new wt(a)),n(a)}else{var i="PlatformHttpTransmitter: Empty response";r.emit("error",new wt(i)),n(i)}})).catch((function(e){r.emit("error",e),n(e)}))}},{key:"signal",value:function(e){var t=this;this._send([e]).catch((function(e){return t.emit("error",e)}))}}])&&At(t.prototype,n),r&&At(t,r),e}();function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Pt.LOGGER=C.getLogger("PlatformHttpTransmitter"),st()(Pt.prototype);var Mt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t,!t&&e.legecyClientSupport&&(e.LOGGER.warn("Legecy support used."),this.client=e.legecyClientSupport)}var t,n,r;return t=e,(n=[{key:"create",value:function(t,n){u("connect(url, config)"),s(t,"url"),e.LOGGER.debug("Creating client context",t,n);var r=new Pt(t,n,this.client);r.on("error",(function(e){d.emit("error",e)}));var o=We.withTransmitter(r).withSlackMS(4).withMaxBatchSize(Number.MAX_SAFE_INTEGER).build(),a=new rt(o),i=new $e(a),l=new Ze(t,o,a,n),c=new lt(o,a,l),d=new dt(o,i,c,l);return e.LOGGER.debug("clientContext created with",d),d}}])&&_t(t.prototype,n),r&&_t(t,r),e}();Mt.LOGGER=C.getLogger("ClientContextFactory"),Mt.legecyClientSupport=!1;function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var It=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"createDirectConnection",value:function(e,t){u("createDirectConnection"),s(e,"authEndpoint"),s(t,"realmName");var n=new XMLHttpRequest;return n.open(A.METHOD.POST,e+"/auth/realms/"+t+"/protocol/openid-connect/token",!0),n.setRequestHeader(A.HEADER_NAME.CONTENT_TYPE,A.CONTENT_TYPE.APPLICATION_X_WWW_FORM_URLENCODED),n.responseType=k,n}},{key:"createServerProxyConnection",value:function(e,t){u("createServerProxyConnection"),s(e,"authEndpoint");var n=new XMLHttpRequest;return n.open(A.METHOD.POST,e,!0),n.setRequestHeader(A.HEADER_NAME.CONTENT_TYPE,A.CONTENT_TYPE.TEXT_PLAIN),l(t)&&n.setRequestHeader(A.HEADER_NAME.X_PLATFORM_SECURITY_REALM,t),n.responseType=k,n}}])&&Ot(t.prototype,n),r&&Ot(t,r),e}();function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Nt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connection=new It}var t,n,r;return t=e,(n=[{key:"createLoginConnection",value:function(e,t,n,r,o,a){var i,u,s=encodeURIComponent(o),c=encodeURIComponent(a),d=encodeURIComponent(r);if(e){if(!l(r))throw Error("No app name set!");i=this.connection.createDirectConnection(t,n),u="client_id="+d+"&username="+s+"&password="+c+"&grant_type=password"}else i=this.connection.createServerProxyConnection(t,n),u="username="+s+"&password="+c+"&grant_type=password";return{connection:i,content:u}}},{key:"createRefreshConnection",value:function(e,t,n,r,o){var a,i,u=encodeURIComponent(r);if(e){if(!l(r))throw Error("No app name set!");a=this.connection.createDirectConnection(t,n),i="grant_type=refresh_token&refresh_token="+o+"&client_id="+u}else a=this.connection.createServerProxyConnection(t,n),i="grant_type=refresh_token&refresh_token="+o;return{connection:a,content:i}}},{key:"receiveToken",value:function(t,n){return new Promise((function(r,o){t.ontimeout=function(e){o(e)},t.onerror=function(e){o(e)},t.onreadystatechange=function(){this.readyState===A.XMLHTTPREQUEST_READYSTATE.DONE&&this.status===A.STATUS.OK?r(this.response):this.readyState===A.XMLHTTPREQUEST_READYSTATE.DONE&&this.status!==A.STATUS.OK&&o(this.status)},e.LOGGER.trace("Receiving token"),t.send(n)}))}},{key:"refreshToken",value:function(e,t,n,r,o){var a=this.createRefreshConnection(e,t,n,r,o),i=a.connection,l=a.content;return this.receiveToken(i,l)}}])&&St(t.prototype,n),r&&St(t,r),e}();function Lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Nt.LOGGER=C.getLogger("KeycloakFunctions");var Dt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.token=null,this.appName=null,this.realm=null}var t,n,r;return t=e,(n=[{key:"setToken",value:function(e){this.token=e}},{key:"setAppName",value:function(e){this.appName=e}},{key:"setRealm",value:function(e){this.realm=e}},{key:"handleRequest",value:function(t){u("handleRequest"),s(t,"httpRequest"),l(this.token)&&(e.LOGGER.trace("Using token",this.token),t.setRequestHeader(A.HEADER_NAME.AUTHORIZATION,"Bearer "+this.token)),l(this.appName)&&(e.LOGGER.trace("Using appName",this.appName),t.setRequestHeader(A.HEADER_NAME.X_PLATFORM_SECURITY_APPLICATION,this.appName)),l(this.realm)&&(e.LOGGER.trace("Using realm",this.realm),t.setRequestHeader(A.HEADER_NAME.X_PLATFORM_SECURITY_REALM,this.realm)),t.setRequestHeader(A.HEADER_NAME.X_PLATFORM_SECURITY_BEARER_ONLY,"true")}}])&&Lt(t.prototype,n),r&&Lt(t,r),e}();function Ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Dt.LOGGER=C.getLogger("SecurityHttpClientInterceptor");var Bt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.functions=new Nt,this.interceptor=new Dt,this.intervall=null,this.configuration={directConnection:!1,authEndpoint:P,appName:null,realmName:null}}var t,n,r;return t=e,(n=[{key:"login",value:function(t,n,r){var o=this;if(this.isAuthorized())throw new Error("Already logged in!");r&&(this.configuration.directConnection=r.directConnection||this.configuration.directConnection,this.configuration.authEndpoint=r.authEndpoint||this.configuration.authEndpoint,this.configuration.appName=r.appName||this.configuration.appName,this.configuration.realmName=r.realmName||this.configuration.realmName);var a=this.configuration,i=a.directConnection,l=a.authEndpoint,u=a.appName,s=a.realmName,c=this.functions.createLoginConnection(i,l,s,u,t,n),d=c.connection,f=c.content,h=this;return new Promise((function(t,n){e.LOGGER.debug("Receiving access token"),o.functions.receiveToken(d,f).then((function(r){if(r&&r.access_token){h.token=r,o.interceptor.setToken(r.access_token),o.interceptor.setRealm(s),o.interceptor.setAppName(u);var a=r.expires_in||e.MIN_TOKEN_EXPIRES_RUN,c=Math.max(e.MIN_TOKEN_EXPIRES_RUN,a-e.TOKEN_EXPIRES_DELTA);h.intervall=setInterval((function(){e.LOGGER.debug("Refreshing access token"),h.functions.refreshToken(i,l,s,u,r.refresh_token).then((function(e){h.token=e,h.interceptor.setToken(e.access_token)}))}),c),t(r.access_token)}else n("No access token found")})).catch((function(e){return n(e)}))}))}},{key:"logout",value:function(){var t=this,n=this;return e.LOGGER.debug("Logout"),new Promise((function(e){delete n.token,n.interceptor.setToken(null),l(t.intervall)&&(clearInterval(t.intervall),t.intervall=null),e()}))}},{key:"isAuthorized",value:function(){return l(this.token)}},{key:"initServiceProvider",value:function(e){u("initServiceProvider"),s(e,"client"),e.getService("HttpClientInterceptor").addRequestInterceptor(this.interceptor)}}])&&Ht(t.prototype,n),r&&Ht(t,r),e}();function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Bt.TOKEN_EXPIRES_DELTA=1e4,Bt.MIN_TOKEN_EXPIRES_RUN=3e4,Bt.LOGGER=C.getLogger("KeycloakSecurity"),function(e){if(l(e)){var t=new w(U,"HttpClient",e),n=new w(j,"HttpClientInterceptor",e);e.registerServiceProvider(t),e.registerServiceProvider(n)}}(b),function(e){if(l(e)){var t=new w(q,"ClientScope");e.registerServiceProvider(t)}}(b),function(e){if(l(e)){var t=new w(Mt,"ClientContextFactory",e);e.registerServiceProvider(t)}}(b),function(e){if(l(e)){var t=new w(Bt,"Security",e);e.registerServiceProvider(t)}}(b),b.init();var Ut=b.getService,xt=b.hasService,jt=b.registerServiceProvider;if(b.LOGGER.info("Rico Version:","1.0.1"),window.Worker&&window.Blob&&window.URL&&URL.createObjectURL){b.LOGGER.debug("Creating Worker");var Vt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blob=new Blob(["self.handleTimeout = function() {    const message = this.statusText || 'Timeout occurred';    const workerMessage = {error: true, message, status: this.status, timedout: true};    self.postMessage(workerMessage);};self.handleError = function () {    let message = this.statusText || 'Unspecified error occured';    const workerMessage = {error: true, message, status: this.status, timedout: false};    self.postMessage(workerMessage);};self.handleStateChange = function () {    if (this.readyState === 4 && this.status >= 200 && this.status < 300) {        const workerMessage = {error: false, response: this.response, status: this.status, url: this.url, responseHeaders: this.getAllResponseHeaders()};        self.postMessage(workerMessage);    } else if (this.readyState === 4 && this.status >= 300) {        const workerMessage = {error: true, message: this.statusText, status: this.status, timedout: false};        self.postMessage(workerMessage);    }};self.addEventListener('message', function(event) {    const timeout = event.data.timeout || 0;    const configuration = event.data.conf || {};    const requestHeaders = event.data.requestHeaders || [];        const httpRequest = new XMLHttpRequest();    const async = true;        httpRequest.open(configuration.method, configuration.url, async);    httpRequest.url = configuration.url;    httpRequest.method = configuration.method;    httpRequest.withCredentials = true;    for (let i = 0; i < requestHeaders.length; i++) {        const header = requestHeaders[i];        httpRequest.setRequestHeader(header.name, header.value);    }    if (configuration.headers && configuration.headers.length > 0) {        for (let i = 0; i < configuration.headers.length; i++) {            const header = configuration.headers[i];            httpRequest.setRequestHeader(header.name, header.value);        }    }    httpRequest.timeout = timeout;    if (configuration.responseType) {        httpRequest.responseType = configuration.responseType;    }    httpRequest.ontimeout = self.handleTimeout.bind(httpRequest);    httpRequest.onerror = self.handleError.bind(httpRequest);    httpRequest.onreadystatechange = self.handleStateChange.bind(httpRequest);    httpRequest.send(configuration.requestBody);});"],{type:"application/javascript"})}var t,n,r;return t=e,(n=[{key:"createWorker",value:function(){return new Worker(URL.createObjectURL(this.blob))}}])&&Gt(t.prototype,n),r&&Gt(t,r),e}(),qt=new w(Vt,"HttpWorker");b.registerServiceProvider(qt)}var Ft=C.getLogger("Deprecated:"),Qt=!0;function Yt(){Qt&&(Ft.warn('Please do not use "dolphin" anymore, it may be removed in the next version! Use the new API instead!'),Qt=!1)}window&&(window.dolphin={get ClientContextFactory(){return Yt(),Mt.legecyClientSupport=b,Mt},get createClientContext(){return Yt(),new Mt(b).create},get LoggerFactory(){return Yt(),C},get LogLevel(){return Yt(),o}})}])}));
//# sourceMappingURL=rico.min.js.map